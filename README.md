# CircleCI Runner Autoscaler

This go application manages the scaling out of CircleCI runners. It's composed of 2 different types of background workers:
* Discovery Worker: discovers new resources classes that should be scaled and spanws new scaling workers
* Scaling Worker: it checks unclaimed tasks on CircleCI for the resource-class it manages, it scales the ASG related to that resource class and waits for instances to be up before continuing.

## CircleCI API Client

There was no opensource client for the CircleCI Runner API, so the one we are using is automatically generated by [oapi-codegen](https://github.com/deepmap/oapi-codegen) based on the OpenAPI Definition available in [here](https://github.com/vela-games/circleci-runner-autoscaler/blob/main/.openapi/definition.yml)

If you make any changes to the yaml file then run to generate the code:
```bash
$ make generate-client
```

## Deploying

Currently this is automatically deployed after build by ArgoCD. You can check the pipeline configuration [here](https://github.com/vela-games/circleci-runner-autoscaler/blob/main/.circleci/config.yml)